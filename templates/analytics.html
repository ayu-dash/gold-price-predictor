{% extends "base.html" %}

{% block title %}Annual Analytics | Gold Futures Pro{% endblock %}

{% block header_title %}Annual Gold Performance{% endblock %}

{% block content %}
<div class="grid-container">
    <!-- ROI Chart -->
    <div class="card chart-card glass grid-span-2">
        <div class="card-header">Year-over-Year ROI Performance (%)</div>
        <div class="chart-container">
            <canvas id="roiChart"></canvas>
        </div>
    </div>

    <div class="card glass">
        <div class="card-header">
            <span>AI Model Accuracy Scorecard</span>
            <button id="retrain_btn" class="tf-btn">
                <span class="material-symbols-outlined">sync</span> Update Model
            </button>
        </div>
        <!-- Training Progress Bar -->
        <div id="training_progress_container"
            style="display: none; padding: 15px 20px; border-bottom: 1px solid var(--glass-border);">
            <div
                style="display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 0.8rem; color: var(--text-muted);">
                <span>Training Progress</span>
                <span id="training_status_text">Initializing...</span>
            </div>
            <div
                style="width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden;">
                <div id="training_progress_bar"
                    style="width: 0%; height: 100%; background: var(--gold); transition: width 0.5s ease;"></div>
            </div>
        </div>

        <div class="scorecard-container">
            <div class="score-main" style="text-align: center; margin: 15px 0;">
                <div class="score-value" id="metric_accuracy" style="font-size: 2.5rem; color: var(--terminal-gold);">
                    --%</div>
                <div class="score-label" style="color: var(--text-muted); font-size: 0.9rem;">Predictive Accuracy</div>
            </div>
            <div class="score-details analytics-metrics" id="score_details">
                <div class="metric-item">
                    <span class="label">Real Win Rate (Reliability):</span>
                    <span id="metric_reliability" class="value text-gold">Calculating...</span>
                </div>
                <div class="metric-item">
                    <span class="label">Directional Accuracy (Classifier):</span>
                    <span id="metric_clf_acc" class="value">--</span>
                </div>
                <div class="metric-item">
                    <span class="label">Median Model (Main) MAE:</span>
                    <span id="metric_mae_med" class="value">--</span>
                </div>
                <div class="metric-item">
                    <span class="label">Low Model (Support) MAE:</span>
                    <span id="metric_mae_low" class="value">--</span>
                </div>
                <div class="metric-item">
                    <span class="label">High Model (Resistance) MAE:</span>
                    <span id="metric_mae_high" class="value">--</span>
                </div>
                <div class="metric-item">
                    <span class="label">Neural Network (Deep Learning) MAE:</span>
                    <span id="metric_mae_nn" class="value text-gold">--</span>
                </div>
                <div class="metric-item" style="border-top: 1px solid var(--glass-border); padding-top: 10px;">
                    <span class="label">Data Samples Covered:</span>
                    <span id="metric_coverage" class="value">--</span>
                </div>
                <div class="metric-item">
                    <span class="label">Last Optimization:</span>
                    <span id="metric_timestamp" class="value" style="font-size: 0.75rem;">--</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Yearly Breakdown Table -->
    <div class="card glass grid-span-full">
        <div class="card-header">Yearly Historical Performance (IDR/Gram)</div>
        <div class="forecast-table-container">
            <table class="forecast-table">
                <thead>
                    <tr>
                        <th>Year</th>
                        <th>Jan 1st (Opening Price)</th>
                        <th>Dec 31st (Closing Price)</th>
                        <th>Annual High (IDR/g)</th>
                        <th>Annual Low (IDR/g)</th>
                        <th>Annual Net ROI (%)</th>
                    </tr>
                </thead>
                <tbody id="yearly_body">
                    <tr>
                        <td colspan="6" class="text-center">Synchronizing annual historical data...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/analytics.js', v='2.0') }}"></script>
{% endblock %}